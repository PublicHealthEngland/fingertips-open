@using Fpm.MainUI
@using Fpm.MainUI.Helpers
@model Fpm.Upload.BatchUpload
@{ Layout = "~/Views/Shared/_LayoutPage.cshtml"; }
@{
    ViewBag.Title = "FPM - Upload Indicator Batch";
}

<script src="@(AppConfig.JsPath)upload-manager.js" type="text/javascript"></script>
<link href="@(AppConfig.CssPath)TableSorter.css" rel="stylesheet" type="text/css" />

<div id="spinner" style="display: none;">
    <img src="/images/ajax-loader.gif" alt="" class="spinner" />
</div>
<div class="standardWidth" style="padding-top: 15px;">
    <h2 class="subheading">Upload validation</h2>
    <table class="summary-table">
        @Html.Partial("_UploadValidationSummary", Model)
        <tr>
            <td class="left">&nbsp;</td>
            <td>
                <div class="button-panel" style="margin-left:0;">
                    @{string backButtonLabel = "Back to upload page";}

                    @if (UploadHelper.AnyDisallowedIndicators(ViewBag.Disallowed))
                    {
                        @Html.Partial("_DisallowedIndicators")
                    }
                    else if (Model.CanFileBeUploaded())
                    {
                        backButtonLabel = "Cancel";
                        if (Model.DuplicateRowInDatabaseErrors.Any())
                        {
                            // There are duplicate rows but the file can still be uploaded
                            @Html.Partial("_UploadAndArchiveButton", Model)
                        }
                        else
                        {
                            // No errors the file can be uploaded
                            using (Html.BeginForm("UploadBatchData", "Upload", FormMethod.Post, new { id = "insertDataForm" }))
                            {
                                @Html.Hidden("excelFilePath", Model.FileName)
                                @Html.Hidden("shortFilename", Model.ShortFileName)
                                @Html.Hidden("selectedWorksheet", Model.SelectedWorksheet)
                                @Html.Hidden("duplicateSpreadsheetErrors", Model.DuplicateRowInSpreadsheetErrors.Count)
                                @Html.HiddenFor(x => x.UploadBatchId)
                                <p>
                                    <input type="button" id="insert-data-to-holding-table" class="medium-button show-spinner"
                                           value="Upload data" />
                                </p>
                            }
                        }
                    }

                    <input type="button" id="cancel-spreadsheet" class="auto-width-button"
                           value="@backButtonLabel" onclick="location.href='@Url.Action("Index", "Upload")'" />

                    @Html.HiddenFor(x => x.FileName)
                    @Html.HiddenFor(x => x.SelectedWorksheet)
                </div>
            </td>
        </tr>
    </table>
    @Html.Partial("_UploadErrors", Model)
</div>
